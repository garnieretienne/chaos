#!/bin/bash
set -e

refresh_role_link(){
  for role in "<%= SERVICEPACKS_DIR %>/<%= name %>/chef/roles/*"; do
    ln -sf $role <%= CHAOS_CHEF_ROLES_DIR %>
  done
}

# Clone or refresh the buildpack directory and link its roles into the chaos chef repo role folder
if ls <%= SERVICEPACKS_DIR %>/<%= name %> > /dev/null; then
  cd <%= SERVICEPACKS_DIR %>/<%= name %>
  git pull origin master &> /dev/null
  refresh_role_link
  echo "updated"
else
  git clone <%= git_url %> <%= SERVICEPACKS_DIR %>/<%= name %>  &> /dev/null
  refresh_role_link
  echo "done"
fi