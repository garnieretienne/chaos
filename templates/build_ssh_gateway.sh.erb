#!/bin/bash
set -e

# Build a gateway executing servicepacks binaries over ssh
gateway=$(cat << EOF
  command=\$@
  ssh -oStrictHostKeyChecking=no -n addons@<%= provider %> <%= SERVICEPACKS_DIR %>/<%= name %>/bin/\${command}
EOF
)

echo "$gateway" > <%= ADDONS_DIR %>/<%= name %>/gateway
chmod +x $HOME/addons/<%= name %>/gateway